set ratios 1:2:3

# Basic vars
set shell bash
set previewer ~/.config/lf/preview
set shellopts '-eu'
set ifs "\n"
set scrolloff 10

# cmds/functions
cmd open ${{
    case $(file --mime-type $f -b) in
      text/*|application/json) $EDITOR $fx;;
    esac
}}

cmd rename %[ -e $1 ] && printf "file exists" || mv $f $1

# Bindings.
# Search and naviagtion is done recursively from a directory where LF has been started (OLDPWD).
# fuzzy file search
map f ${{
  set -f
  path=$(fzf --walker-root $OLDPWD --walker-skip=.git,.devenv,.venv)
  lf -remote "send $id select $path"
}}

# jump to top (shift + g jumps down)
map g top

# delete a file or directory
map d ${{
  set -f
  printf "%s\n\t" "$fx"
  printf "delete?[y/n] "
  read ans
  if [ $ans = "y" ]; then
    while IFS= read -r f; do
      rm -rv $f
    done <<< "$fx"
  fi
}}

# copy a file or directory
map c ${{
  dest="$(find $OLDPWD -type d -print 2>/dev/null | fzf)" &&
  eval cp -ivr $fx $dest
}}

# move a file or directory
map m ${{
  dest="$(find $OLDPWD -type d -print 2>/dev/null | fzf)" &&
  eval mv -iv $fx $dest
}}

# create a file or directory
map a ${{
  set -f
  echo "Content of directory $PWD"
  exa -a -s type
  read -p "New file or directory name? " path
  if [[ $path == */ ]]; then
    mkdir -p $path
  else
    mkdir -p $(dirname $path)
    touch $path
  fi
  lf -remote "send $id select $path"
}}

map <backspace2> ${{
  # Disallow leaving OLDPWD
  # You still can leave it pressing `h`.
  # FIXME: probably because of -remote lf redraws on backspace2 press.
  if [[ "$PWD" != "$OLDPWD" ]]; then
    lf -remote "send $id cd $(dirname $PWD)"
  fi
}}

map r push :rename<space>
map <enter> open
